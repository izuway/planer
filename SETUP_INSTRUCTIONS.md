# üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### Backend (Cloudflare Workers)
1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase Auth middleware
2. ‚úÖ –°–æ–∑–¥–∞–Ω—ã –ø—É–±–ª–∏—á–Ω—ã–µ –∏ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ API –º–∞—Ä—à—Ä—É—Ç—ã
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email –Ω–∞ —É—Ä–æ–≤–Ω–µ middleware
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ KV —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π Firebase

### Frontend (React + Material-UI)
1. ‚úÖ –°–æ–∑–¥–∞–Ω Firebase config —Å –≤–∞—à–∏–º–∏ credentials
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω Auth Context –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
3. ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∫—Ä–∞—Å–∏–≤—ã–µ —Ñ–æ—Ä–º—ã Login –∏ Register
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ email —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π –ø–∏—Å—å–º–∞
5. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —ç–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email
6. ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage
7. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
1. ‚úÖ AUTH_SETUP.md - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
2. ‚úÖ QUICK_START_AUTH.md - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
3. ‚úÖ API.md - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö endpoints
4. ‚úÖ src/utils/api.ts - –≥–æ—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–æ–∑–¥–∞–π—Ç–µ KV Namespace

```bash
npx wrangler kv:namespace create PUBLIC_JWK_CACHE_KV
```

–í—ã –ø–æ–ª—É—á–∏—Ç–µ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
```
{ binding = "PUBLIC_JWK_CACHE_KV", id = "abc123def456" }
```

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–∏—Ç–µ wrangler.jsonc

–û—Ç–∫—Ä–æ–π—Ç–µ `wrangler.jsonc` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ `YOUR_KV_ID_HERE` –Ω–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π ID:

```jsonc
"kv_namespaces": [
  {
    "binding": "PUBLIC_JWK_CACHE_KV",
    "id": "abc123def456"  // ‚Üê –í–∞—à —Ä–µ–∞–ª—å–Ω—ã–π ID
  }
]
```

### –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Firebase Console

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://console.firebase.google.com/project/planer-246d3/authentication
2. –í —Ä–∞–∑–¥–µ–ª–µ **Sign-in method**:
   - –í–∫–ª—é—á–∏—Ç–µ **Email/Password**
3. –í —Ä–∞–∑–¥–µ–ª–µ **Settings** ‚Üí **Authorized domains**:
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω `planer.m-k-mendykhan.workers.dev`
4. –í —Ä–∞–∑–¥–µ–ª–µ **Templates** ‚Üí **Email address verification**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL –≤ —à–∞–±–ª–æ–Ω–µ: `https://planer.m-k-mendykhan.workers.dev/`

## üéØ –î–µ–ø–ª–æ–π

```bash
npm run deploy
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://planer.m-k-mendykhan.workers.dev/
2. –ù–∞–∂–º–∏—Ç–µ "Sign up"
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —Å —Ä–µ–∞–ª—å–Ω—ã–º email
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email
5. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç –∏ –≤–æ–π–¥–∏—Ç–µ

### –¢–µ—Å—Ç API:

**–ü—É–±–ª–∏—á–Ω—ã–π endpoint (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ç–æ–∫–µ–Ω–∞):**
```bash
curl https://planer.m-k-mendykhan.workers.dev/api/test
```

**–ó–∞—â–∏—â–µ–Ω–Ω—ã–π endpoint (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω):**
```bash
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ localStorage –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
# localStorage.getItem('firebaseToken')

curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://planer.m-k-mendykhan.workers.dev/api/profile
```

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
planer/
‚îú‚îÄ‚îÄ worker/                         # Backend (Cloudflare Workers)
‚îÇ   ‚îú‚îÄ‚îÄ index.ts                   # Main worker —Å –º–∞—Ä—à—Ä—É—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ types.ts                   # TypeScript —Ç–∏–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts              # –≠–∫—Å–ø–æ—Ä—Ç—ã middleware
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.ts               # Firebase Auth middleware
‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ       ‚îî‚îÄ‚îÄ versions.ts           # API –≤–µ—Ä—Å–∏–π
‚îÇ
‚îú‚îÄ‚îÄ src/                           # Frontend (React)
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx                   # Main app —Å –∑–∞—â–∏—Ç–æ–π –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx                  # Entry point —Å AuthProvider
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ firebase.ts          # Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.tsx      # Auth –∫–æ–Ω—Ç–µ–∫—Å—Ç
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.tsx            # –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Register.tsx         # –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ api.ts               # API —É—Ç–∏–ª–∏—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ wrangler.jsonc                # Cloudflare Workers config
‚îú‚îÄ‚îÄ AUTH_SETUP.md                 # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ QUICK_START_AUTH.md           # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
‚îî‚îÄ‚îÄ API.md                        # API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîê –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –ü–æ—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Register Form ‚Üí Firebase Auth
                    ‚Üì
              Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
                    ‚Üì
              User logout
                    ‚Üì
    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç —Å—Å—ã–ª–∫—É –≤ email
                    ‚Üì
          Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
                    ‚Üì
    –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ planer.m-k-mendykhan.workers.dev
                    ‚Üì
              Login Form
                    ‚Üì
            –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
```

### –ü–æ—Ç–æ–∫ API –∑–∞–ø—Ä–æ—Å–∞:
```
Frontend ‚Üí getIdToken() ‚Üí localStorage
              ‚Üì
        Fetch —Å Bearer token
              ‚Üì
        Backend Middleware
              ‚Üì
     –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT + email_verified
              ‚Üì
         API Response
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```typescript
import { useAuth } from './contexts/AuthContext';

function MyComponent() {
  const { user } = useAuth();
  
  return (
    <div>
      <p>Email: {user?.email}</p>
      <p>Verified: {user?.emailVerified ? 'Yes' : 'No'}</p>
    </div>
  );
}
```

### –°–¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:

```typescript
import { authenticatedFetch } from './utils/api';

async function fetchUserData() {
  const response = await authenticatedFetch('/api/profile');
  const data = await response.json();
  console.log(data);
}
```

### –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã:

```typescript
import { useAuth } from './contexts/AuthContext';

function LogoutButton() {
  const { signOut } = useAuth();
  
  return (
    <button onClick={signOut}>
      Sign Out
    </button>
  );
}
```

## üîß –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö endpoints

–í `worker/index.ts`:

```typescript
// –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π –∑–∞—â–∏—â–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
protectedApi.get('/my-endpoint', async (c) => {
  const user = c.get('user');
  
  if (!user) {
    return c.json({ error: 'Unauthorized' }, 401);
  }
  
  // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –∑–¥–µ—Å—å
  return c.json({
    message: 'Success',
    userId: user.uid,
  });
});
```

## ‚ùì –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å KV

**–†–µ—à–µ–Ω–∏–µ:** 
```bash
# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π namespace –µ—Å–ª–∏ –µ—Å—Ç—å
npx wrangler kv:namespace delete --namespace-id=OLD_ID

# –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π
npx wrangler kv:namespace create PUBLIC_JWK_CACHE_KV

# –û–±–Ω–æ–≤–∏—Ç–µ ID –≤ wrangler.jsonc
```

### –ü—Ä–æ–±–ª–µ–º–∞: Email verification –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –í Firebase Console ‚Üí Authentication ‚Üí Templates –ø—Ä–æ–≤–µ—Ä—å—Ç–µ URL
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω –≤ Authorized domains
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Resend Verification Email

### –ü—Ä–æ–±–ª–µ–º–∞: Token expired

**–†–µ—à–µ–Ω–∏–µ:**
- –í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
- –¢–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `getIdToken(true)`

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [AUTH_SETUP.md](./AUTH_SETUP.md)
- **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:** [QUICK_START_AUTH.md](./QUICK_START_AUTH.md)
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [API.md](./API.md)
- **Firebase Docs:** https://firebase.google.com/docs/auth
- **Hono Firebase Auth:** https://github.com/honojs/middleware/tree/main/packages/firebase-auth

---

**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é! üéâ**

–ù–µ –∑–∞–±—É–¥—å—Ç–µ:
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å KV namespace
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ID –≤ wrangler.jsonc
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Firebase Console
4. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run deploy`

